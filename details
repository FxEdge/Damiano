<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Dettagli contatto</title>
  <link rel="icon" href="assets/logo.svg">
  <style>
    :root{--bg:#f3f4f6;--surface:#fff;--text:#111827;--muted:#6b7280;--border:#e5e7eb;--primary:#2563eb}
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--text);font:15px/1.45 system-ui,-apple-system,Segoe UI,Roboto}
    .wrap{width:min(1100px,92%);margin-inline:auto;padding:20px}
    header{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}
    .card{background:var(--surface);border:1px solid var(--border);border-radius:14px;box-shadow:0 6px 18px rgba(0,0,0,.06);padding:16px}
    h1{margin:0 0 8px}
    .muted{color:var(--muted)}
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    label{display:block;font-weight:600;margin:8px 0 6px}
    input[type="text"], input[type="date"], input[type="number"], textarea{
      width:100%;padding:10px;border:1px solid var(--border);border-radius:10px;font:inherit;background:#fff
    }
    textarea{min-height:140px;resize:vertical;white-space:pre-wrap}
    .actions{display:flex;gap:8px;justify-content:flex-end;margin-top:12px}
    .btn{padding:10px 14px;border-radius:10px;border:1px solid var(--border);background:#fff;cursor:pointer}
    .btn-primary{background:linear-gradient(135deg,#3b82f6,#2563eb);color:#fff;border:none}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>Dettagli contatto</h1>
      <button id="btnBack" class="btn">‚Üê Torna indietro</button>
    </header>

    <section class="card">
      <form id="form" class="grid">
        <input type="hidden" id="rid">

        <div>
          <label>Nome</label>
          <input type="text" id="nome">
        </div>
        <div>
          <label>Cognome</label>
          <input type="text" id="cognome">
        </div>

        <div>
          <label>Email</label>
          <input type="text" id="email">
        </div>
        <div>
          <label>Telefono (prefisso)</label>
          <input type="text" id="prefisso" value="+39">
        </div>

        <div>
          <label>Telefono (numero)</label>
          <input type="text" id="telefono">
        </div>
        <div>
          <label>Giorni prima (promemoria)</label>
          <input type="number" id="giorni" min="0">
        </div>

        <div>
          <label>Defunto ‚Äì Nome</label>
          <input type="text" id="def_nome">
        </div>
        <div>
          <label>Defunto ‚Äì Cognome</label>
          <input type="text" id="def_cognome">
        </div>

        <div>
          <label>Defunto ‚Äì Data (YYYY-MM-DD)</label>
          <input type="date" id="def_data">
        </div>
        <div>
          <label>Oggetto email</label>
          <input type="text" id="oggetto">
        </div>

        <div style="grid-column:1 / -1">
          <label>Corpo email</label>
          <textarea id="corpo"></textarea>
        </div>

        <div class="actions" style="grid-column:1 / -1">
          <button type="button" id="btnExit" class="btn">Esci</button>
          <button type="submit" class="btn btn-primary">üíæ Salva</button>
        </div>
      </form>
    </section>

    <p class="muted" style="margin-top:10px">API: <code id="apiInUso"></code></p>
  </div>

  <script>
    // ===== Guard auth =====
    if (!localStorage.getItem('damiano_token')) { location.replace('index.html'); }

    // ===== API base =====
    const DEFAULT_API = 'https://damiano-backend-ancz.onrender.com';
    const API = localStorage.getItem('damiano_api') || DEFAULT_API;
    document.getElementById('apiInUso').textContent = API;

    // ===== Helpers =====
    const $ = s => document.querySelector(s);
    const params = new URLSearchParams(location.search);
    const rid = params.get('id');
    const from = params.get('from'); //

