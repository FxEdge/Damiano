<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Damiano ‚Äì Dashboard</title>
  <link rel="icon" href="assets/logo.svg">
  <style>
    :root{--bg:#f3f4f6;--surface:#fff;--text:#111827;--muted:#6b7280;--border:#e5e7eb;--shadow:0 6px 18px rgba(0,0,0,.06);--primary:#2563eb}
    *{box-sizing:border-box} body{margin:0;background:var(--bg);color:var(--text);font:15px/1.45 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,"Helvetica Neue",Arial}
    .wrap{width:min(1100px,92%);margin-inline:auto;padding:20px}
    header{display:flex;align-items:center;justify-content:space-between;margin-bottom:12px}
    .brand{display:flex;align-items:center;gap:10px}
     h1{margin:0;font-size:1.5rem}
    .grid{display:grid;grid-template-columns:1.1fr .9fr;gap:16px}
    .card{background:var(--surface);border:1px solid var(--border);border-radius:16px;box-shadow:var(--shadow);padding:16px}
    .card h2{margin:0 0 10px;font-size:1.1rem}
    .btn{display:inline-block;padding:10px 14px;border-radius:12px;border:1px solid var(--border);background:#fff;cursor:pointer;margin:6px 6px 0 0}
    .btn-primary{background:linear-gradient(135deg,#3b82f6,#2563eb);color:#fff;border:none}
    .muted{color:var(--muted)}
    .report{display:grid;gap:8px}
    .report .box{border:1px dashed var(--border);border-radius:12px;padding:10px}
     /* Logo grande al centro */
    .top-logo {
     display: flex;
    justify-content: center; /* centro orizzontale */
   align-items: center;     /* centro verticale (se vuoi) */
    margin: 20px 0;
   }
  .top-logo img {
  max-width: 140px;
  height: auto;
}  
    /* === NUOVO: metti i tre bottoni in colonna e a tutta larghezza === */
    .actions-stack{display:flex;flex-direction:column;gap:12px;margin-top:8px}
    .actions-stack .btn-primary{width:100%;text-align:left}
    .actions-stack .btn-primary:hover{filter:brightness(0.95)}
  </style>
</head>
  <!-- ========== DEV OVERLAY (nascosto) ========== -->
<style>
  .dev-overlay{position:fixed;inset:0;background:#0b102214;backdrop-filter:blur(3px);display:none;z-index:9999}
  .dev-card{max-width:1000px;margin:40px auto;background:#fff;border-radius:16px;box-shadow:0 10px 30px rgba(0,0,0,.08);padding:18px}
  .dev-h1{margin:0 0 10px;font:600 22px system-ui}
  .dev-row{display:flex;gap:10px;flex-wrap:wrap;align-items:center;margin:8px 0 14px}
  .dev-input{padding:10px 12px;border:1px solid #e5e7eb;border-radius:10px;min-width:260px}
  .dev-btn{padding:10px 14px;border:0;border-radius:10px;background:#2563eb;color:#fff;cursor:pointer}
  .dev-btn.ghost{background:#e5e7eb;color:#111827}
  .dev-right{margin-left:auto}
  .dev-status{min-height:22px;font:14px system-ui;margin-top:6px}
  .ok{color:#15803d}.err{color:#b91c1c}
  table.dev{width:100%;border-collapse:collapse;margin-top:8px}
  table.dev th,table.dev td{padding:9px 8px;border-bottom:1px solid #eee;text-align:left;font:14px system-ui}
  .dev-badge{font:12px system-ui;background:#eef2ff;color:#3730a3;border-radius:999px;padding:2px 8px}
  .dev-dim{color:#6b7280}
  /* login modal */
  .dev-modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:#0007;z-index:10000}
  .dev-modal .box{background:#fff;padding:20px;border-radius:12px;min-width:320px;box-shadow:0 10px 30px rgba(0,0,0,.15)}
  .dev-modal h3{margin:0 0 8px;font:600 18px system-ui}
  .dev-modal .row{display:flex;flex-direction:column;gap:8px;margin:10px 0}
  .dev-modal input{padding:10px;border:1px solid #e5e7eb;border-radius:10px}
</style>

<!-- Login ‚Äúadmin/admin‚Äù -->
<div id="devLogin" class="dev-modal">
  <div class="box">
    <h3>Accesso Sviluppatore</h3>
    <div class="row">
      <input id="devUser" placeholder="Username" />
      <input id="devPass" placeholder="Password" type="password" />
    </div>
    <div style="display:flex;gap:8px;justify-content:flex-end">
      <button class="dev-btn ghost" id="devCancel">Annulla</button>
      <button class="dev-btn" id="devEnter">Entra</button>
    </div>
  </div>
</div>

<!-- Pannello sviluppatore -->
<div id="devOverlay" class="dev-overlay" aria-hidden="true">
  <div class="dev-card">
    <div style="display:flex;align-items:center;gap:10px">
      <div class="dev-h1">‚öôÔ∏è Area Sviluppatore</div>
      <button class="dev-btn ghost dev-right" id="devExit">Esci</button>
    </div>

    <div class="dev-row">
      <input id="devBaseUrl" class="dev-input" placeholder="Backend URL" />
      <input id="devSecret"  class="dev-input" placeholder="X-Secret (es. demo)" />
      <button class="dev-btn" id="devSave">Salva</button>
      <button class="dev-btn ghost" id="devLoad">Invia e mail manualmente</button>
    </div>

    <div id="devStatus" class="dev-status"></div>

    <table class="dev" id="devTable">
      <thead>
        <tr>
          <th>Nome</th><th>Email</th><th>Prossima ricorrenza</th><th>ID</th>
        </tr>
      </thead>
      <tbody id="devBody">
        <tr><td colspan="4" class="dev-dim">Nessun dato</td></tr>
      </tbody>
    </table>
  </div>
</div>

<script>
(function(){
  const $ = (id)=>document.getElementById(id);
  const LS_BASE="dev_base_url", LS_SECRET="dev_x_secret", LS_AUTH="dev_is_auth";
  const DEFAULT_BASE="https://damiano-backend-ancz.onrender.com"; // modifica se serve

  // elementi
  const btnDev = $("btnDev");
  const overlay = $("devOverlay");
  const status  = $("devStatus");
  const tbody   = $("devBody");
  const baseUrl = $("devBaseUrl");
  const secret  = $("devSecret");
  const btnSave = $("devSave");
  const btnLoad = $("devLoad");
  const btnExit = $("devExit");
  const login   = $("devLogin");
  const devUser = $("devUser");
  const devPass = $("devPass");
  const btnEnter= $("devEnter");
  const btnCancel=$("devCancel");

  // init fields
  baseUrl.value = localStorage.getItem(LS_BASE) || DEFAULT_BASE;
  secret.value  = localStorage.getItem(LS_SECRET) || "";

  function setStatus(msg, ok){ status.className = "dev-status "+(ok?"ok":"err"); status.textContent = msg; }

  // HOME: click su "Sviluppatore"
  btnDev?.addEventListener("click", ()=>{
    // se gi√† autenticato mostra overlay, altrimenti login
    if(localStorage.getItem(LS_AUTH)==="1"){ openOverlay(); }
    else { openLogin(); }
  });

  function openLogin(){
    login.style.display="flex";
    devUser.value=""; devPass.value="";
    devUser.focus();
  }
  function closeLogin(){ login.style.display="none"; }

  btnCancel.addEventListener("click", closeLogin);
  btnEnter.addEventListener("click", ()=>{
    if(devUser.value==="admin" && devPass.value==="admin"){
      localStorage.setItem(LS_AUTH,"1");
      closeLogin(); openOverlay();
    }else{
      alert("Credenziali errate. Username: admin, Password: admin");
    }
  });

  function openOverlay(){
    overlay.style.display="block";
    setStatus("Pronto.", true);
  }
  function closeOverlay(){
    overlay.style.display="none";
    setStatus("", true);
  }

  btnExit.addEventListener("click", ()=>{
    closeOverlay();
  });

  // salva impostazioni
  btnSave.addEventListener("click", ()=>{
    localStorage.setItem(LS_BASE, baseUrl.value.trim());
    localStorage.setItem(LS_SECRET, secret.value.trim());
    setStatus("Impostazioni salvate ‚úîÔ∏è", true);
  });

  // carica contatti (anche gi√† inviati ‚Äì qui non c'√® filtro)
  btnLoad.addEventListener("click", async ()=>{
    const base = baseUrl.value.trim();
    if(!base){ setStatus("Imposta il Backend URL", false); return; }
    tbody.innerHTML = `<tr><td colspan="4" class="dev-dim">Caricamento‚Ä¶</td></tr>`;
    try{
      const res = await fetch(`${base}/records`);
      const data = await res.json();
      renderRows(Array.isArray(data)?data:[]);
      setStatus(`Caricati ${ (data||[]).length } contatti`, true);
    }catch(e){
      setStatus("Errore nel recupero dei contatti", false);
      tbody.innerHTML = `<tr><td colspan="4" class="dev-dim">Errore</td></tr>`;
    }
  });

  function renderRows(list){
    if(!list.length){ tbody.innerHTML = `<tr><td colspan="4" class="dev-dim">Nessun contatto</td></tr>`; return; }
    tbody.innerHTML = "";
    for(const r of list){
      const tr = document.createElement("tr");
      tr.dataset.rid = r.id;
      tr.innerHTML = `
        <td><strong>${r.nome||""} ${r.cognome||""}</strong></td>
        <td>${r.email||"<span class='dev-dim'>‚Äî</span>"}</td>
        <td>${r.prossima_ricorrenza||"<span class='dev-dim'>‚Äî</span>"}</td>
        <td><span class="dev-badge">${r.id||""}</span></td>
      `;
      tr.ondblclick = ()=>confirmSendNow(r.id, r.email);
      tbody.appendChild(tr);
    }
  }

  async function confirmSendNow(rid, email){
    if(!rid){ return; }
    if(!confirm(`Vuoi inviare la mail ORA per:\n${email || rid}?`)) return;

    const base = baseUrl.value.trim();
    const sec  = secret.value.trim();
    if(!sec){ setStatus("Inserisci X-Secret", false); return; }

    try{
      const res = await fetch(`${base}/admin/send-now/${rid}`, {
        method:"POST",
        headers: { "X-Secret": sec }
      });
      const data = await res.json();
      if(res.ok && data.ok){ setStatus("‚úÖ Email inviata", true); }
      else { setStatus("‚ùå " + (data.detail || JSON.stringify(data)), false); }
    }catch(e){ setStatus("‚ùå Errore di rete", false); }
  }

  // chiudi overlay con ESC
  document.addEventListener("keydown", (e)=>{
    if(e.key==="Escape" && overlay.style.display==="block") closeOverlay();
  });
})();
</script>
<body>
  <!-- LOGO CENTRALE -->
  <div class="top-logo">
    <img src="assets/logo.png" alt="Damiano Logo">
  </div>
  <div class="wrap">
    <header>
      <div class="brand">
              <div>
          <div class="muted" id="today"></div>
          <h1>Dashboard</h1>
        </div>
      </div>
      <button id="btnLogout" class="btn">Esci</button>
    </header>

    <div class="grid">
      <!-- Sezione Dati -->
      <section class="card">
        <h2>Sezione Dati</h2>
        <p class="muted">Gestisci le schede clienti.</p>

        <!-- SOLO QUESTO BLOCCO √à CAMBIATO -->
        <div class="actions-stack">
          <a href="new.html" class="btn btn-primary">‚ûï Nuovo inserimento</a>
          <a href="search.html?mode=edit" class="btn btn-primary">‚úèÔ∏è Modifica inserimento</a>
          <a href="visualizza.html" class="btn btn-primary">üëÅÔ∏è Visualizzazione inserimento</a>
        </div>
      </section>
       <!-- ‚úÖ NUOVA CARD -->
  <section class="card">
    <h2>Sezione Config</h2>
    <p>Impostazioni dei testi email.</p>
    <a class="btn btn-primary" href="/dati-email.html">üìß Dati Email</a>
  </section>
      
          <!-- Sezione Report -->
<section class="card">
  <h2>Sezione Report</h2>
  <p class="muted">Statistiche e analisi.</p>
  <div class="report">
    <a href="report1.html" class="btn btn-primary">üìß Mail inviate mese</a>
    <a href="report2.html" class="btn">üìÜ Da inviare mese prossimo</a>
    <a href="report3.html" class="btn">üìà Report 3</a>
    <a href="log-invii.html" class="btn btn-primary">üì¨ Log invii</a>
  </div>
</section>

    </div>

    <p class="muted" style="margin-top:14px">API: <code id="apiInUso"></code></p>
  </div>

  <script>
    // Guard: serve token
    if (!localStorage.getItem('damiano_token')) { location.replace('index.html'); }

    const DEFAULT_API = 'https://damiano-backend-ancz.onrender.com';
    const API = localStorage.getItem('damiano_api') || DEFAULT_API;

    document.getElementById('today').textContent = new Date().toLocaleString('it-IT', {dateStyle:'full', timeStyle:'short'});
    document.getElementById('apiInUso').textContent = API;

    // Logout
    document.getElementById('btnLogout').addEventListener('click', () => {
      localStorage.removeItem('damiano_token');
      localStorage.removeItem('damiano_user');
      location.replace('index.html');
    });

    // Stub report
    document.getElementById('rep1').textContent = '0';
    document.getElementById('rep2').textContent = '0';
    document.getElementById('rep3').textContent = '‚Äî';
  </script>
  <button id="btnDev">‚öôÔ∏è Sviluppatore</button>
</body>
</html>









